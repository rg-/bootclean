<?php

/*

	/wp-admin/admin-ajax.php?action=get_template&name=ajax/insert_wpbc_template 

*/



$json_post = '{"post_title":"Jumbotron","post_status":"draft","post_type":"wpbc_template","meta_input":{"_edit_last":["1"],"_edit_lock":["1623619118:1"],"content_rows_0_ui_layout_html__code":["<div class=\"jumbotron gmt-1 gmb-1\">\r\n  <h1 class=\"display-4\">POSTS Advanced<\/h1>\r\n<\/div>"],"_content_rows_0_ui_layout_html__code":["field_ui_layout_html__code"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_id":[""],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_id":["field_ui_layout_html__attributes_id"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_class":[""],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_class":["field_ui_layout_html__attributes_class"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_classes":["1"],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_classes":["field_ui_layout_html__attributes_classes"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_container_class":["container"],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_container_class":["field_ui_layout_html__attributes_container_class"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_row_class":["row"],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_row_class":["field_ui_layout_html__attributes_row_class"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_column_class":["col-12"],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_column_class":["field_ui_layout_html__attributes_column_class"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_data":[""],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes_ui_layout_html__attributes_data":["field_ui_layout_html__attributes_data"],"content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes":[""],"_content_rows_0_ui_layout_html__section_settings_ui_layout_html__attributes":["field_ui_layout_html__attributes"],"content_rows_0_ui_layout_html__section_settings":[""],"_content_rows_0_ui_layout_html__section_settings":["field_ui_layout_html__section_settings"],"content_rows_0_ui_layout_html__section_visible":["0"],"_content_rows_0_ui_layout_html__section_visible":["field_ui_layout_html__section_visible"],"content_rows_0_ui_layout_html__section_styles_ui_layout_html__section_styles_background_color":["transparent"],"_content_rows_0_ui_layout_html__section_styles_ui_layout_html__section_styles_background_color":["field_ui_layout_html__section_styles_background_color"],"content_rows_0_ui_layout_html__section_styles_ui_layout_html__section_styles_text_color":["body-color"],"_content_rows_0_ui_layout_html__section_styles_ui_layout_html__section_styles_text_color":["field_ui_layout_html__section_styles_text_color"],"content_rows_0_ui_layout_html__section_styles":[""],"_content_rows_0_ui_layout_html__section_styles":["field_ui_layout_html__section_styles"],"content_rows":["a:1:{i:0;s:14:\"ui_layout_html\";}"],"_content_rows":["key__flexible_content_rows"],"wpbc_template_helper_comments":[""],"_wpbc_template_helper_comments":["field_wpbc_template_helper_comments"]}}';

$json_post = '{"post_title":"Full aside cols","post_status":"draft","post_type":"page","meta_input":{"_wp_page_template":["_template_builder.php"],"_edit_lock":["1623473263:1"],"_edit_last":["1"],"layout_main_navbar_template":[""],"_layout_main_navbar_template":["field_layout_main_navbar_template"],"layout_header_template_type":["title"],"_layout_header_template_type":["field_layout_header_template_type"],"layout_footer_template":[""],"_layout_footer_template":["field_layout_footer_template"],"custom_layout__enable":["0"],"_custom_layout__enable":["field_custom_layout__enable"],"layout_code_body_class":[""],"_layout_code_body_class":["field_layout_code__body_class"],"code_styles_code_styles_all":[""],"_code_styles_code_styles_all":["field_code_styles_all"],"code_styles_code_styles_xs":[""],"_code_styles_code_styles_xs":["field_code_styles_xs"],"code_styles_code_styles_sm":[""],"_code_styles_code_styles_sm":["field_code_styles_sm"],"code_styles_code_styles_md":[""],"_code_styles_code_styles_md":["field_code_styles_md"],"code_styles_code_styles_lg":[""],"_code_styles_code_styles_lg":["field_code_styles_lg"],"code_styles_code_styles_xl":[""],"_code_styles_code_styles_xl":["field_code_styles_xl"],"code_styles":[""],"_code_styles":["field_group_code_styles"],"layout_code_styles":[""],"_layout_code_styles":["field_layout_code__clone"],"content_rows":["a:1:{i:0;s:26:\"ui_layout_full_content_fit\";}"],"_content_rows":["key__flexible_content_rows"],"content_rows_0_ui_layout_full_content_fit__breakpoint":["lg"],"_content_rows_0_ui_layout_full_content_fit__breakpoint":["field_ui_layout_full_content_fit__breakpoint"],"content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_id":[""],"_content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_id":["field_ui_layout_full_content_fit__attributes_id"],"content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_class":[""],"_content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_class":["field_ui_layout_full_content_fit__attributes_class"],"content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_classes":["0"],"_content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_classes":["field_ui_layout_full_content_fit__attributes_classes"],"content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_data":[""],"_content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes_ui_layout_full_content_fit__attributes_data":["field_ui_layout_full_content_fit__attributes_data"],"content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes":[""],"_content_rows_0_ui_layout_full_content_fit__section_settings_ui_layout_full_content_fit__attributes":["field_ui_layout_full_content_fit__attributes"],"content_rows_0_ui_layout_full_content_fit__section_settings":[""],"_content_rows_0_ui_layout_full_content_fit__section_settings":["field_ui_layout_full_content_fit__section_settings"],"content_rows_0_ui_layout_full_content_fit__section_visible":["0"],"_content_rows_0_ui_layout_full_content_fit__section_visible":["field_ui_layout_full_content_fit__section_visible"],"content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_background_color":["transparent"],"_content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_background_color":["field_ui_layout_full_content_fit__section_styles_background_color"],"content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_text_color":["body-color"],"_content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_text_color":["field_ui_layout_full_content_fit__section_styles_text_color"],"content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_images":[""],"_content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_images":["field_ui_layout_full_content_fit__section_styles_images"],"content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_html":[""],"_content_rows_0_ui_layout_full_content_fit__section_styles_ui_layout_full_content_fit__section_styles_html":["field_ui_layout_full_content_fit__section_styles_html"],"content_rows_0_ui_layout_full_content_fit__section_styles":[""],"_content_rows_0_ui_layout_full_content_fit__section_styles":["field_ui_layout_full_content_fit__section_styles"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-use":["1"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-use":["field_ui_layout_full_content_fit__columns_content__section-title-use"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content_wysiwyg":["Something"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content_wysiwyg":["field_ui_layout_full_content_fit__columns_content_wysiwyg"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content":[""],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content":["field_ui_layout_full_content_fit__columns_content"],"content_rows_0_ui_layout_full_content_fit__columns":["2"],"_content_rows_0_ui_layout_full_content_fit__columns":["field_ui_layout_full_content_fit__columns"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_type":["content-overlap"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_type":["field_ui_layout_full_content_fit__columns_style_type"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_size":["6"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_size":["field_ui_layout_full_content_fit__columns_style_size"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color":["#ce3c50"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color":["field_ui_layout_full_content_fit__columns_style_backgrund_color"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color":["#ffffff"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color":["field_ui_layout_full_content_fit__columns_style_text_color"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_gallery":["a:2:{i:0;s:1:\"9\";i:1;s:1:\"8\";}"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_gallery":["field_ui_layout_full_content_fit__columns_style_gallery"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style":[""],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style":["field_ui_layout_full_content_fit__columns_style"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-use":["1"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-use":["field_ui_layout_full_content_fit__columns_content__section-title-use"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content_wysiwyg":["Something"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content_wysiwyg":["field_ui_layout_full_content_fit__columns_content_wysiwyg"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content":[""],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content":["field_ui_layout_full_content_fit__columns_content"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_type":["default"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_type":["field_ui_layout_full_content_fit__columns_style_type"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_size":["6"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_size":["field_ui_layout_full_content_fit__columns_style_size"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color":["#212529"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color":["field_ui_layout_full_content_fit__columns_style_backgrund_color"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color":["#ffffff"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color":["field_ui_layout_full_content_fit__columns_style_text_color"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_gallery":[""],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_gallery":["field_ui_layout_full_content_fit__columns_style_gallery"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style":[""],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style":["field_ui_layout_full_content_fit__columns_style"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__wysiwyg":["Something"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__wysiwyg":["field_ui_layout_full_content_fit__columns_content__wysiwyg"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__wysiwyg":["Something"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__wysiwyg":["field_ui_layout_full_content_fit__columns_content__wysiwyg"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings_ui_layout_full_content_fit__columns_content__section-title-settings__heading":[".display-2"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings_ui_layout_full_content_fit__columns_content__section-title-settings__heading":["field_ui_layout_full_content_fit__columns_content__section-title-settings__heading"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings":[""],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings":["field_ui_layout_full_content_fit__columns_content__section-title-settings"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title":["Section Title here"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title":["field_ui_layout_full_content_fit__columns_content__section-title"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color_breakpoint":["#ffc107"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color_breakpoint":["field_ui_layout_full_content_fit__columns_style_backgrund_color_breakpoint"],"content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color_breakpoint":["#ffffff"],"_content_rows_0_ui_layout_full_content_fit__columns_0_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color_breakpoint":["field_ui_layout_full_content_fit__columns_style_text_color_breakpoint"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color_breakpoint":["#212529"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_backgrund_color_breakpoint":["field_ui_layout_full_content_fit__columns_style_backgrund_color_breakpoint"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color_breakpoint":["#ffffff"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_style_ui_layout_full_content_fit__columns_style_text_color_breakpoint":["field_ui_layout_full_content_fit__columns_style_text_color_breakpoint"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings_ui_layout_full_content_fit__columns_content__section-title-settings__heading":[".display-2"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings_ui_layout_full_content_fit__columns_content__section-title-settings__heading":["field_ui_layout_full_content_fit__columns_content__section-title-settings__heading"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings":[""],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title-settings":["field_ui_layout_full_content_fit__columns_content__section-title-settings"],"content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title":["Section title"],"_content_rows_0_ui_layout_full_content_fit__columns_1_ui_layout_full_content_fit__columns_content_ui_layout_full_content_fit__columns_content__section-title":["field_ui_layout_full_content_fit__columns_content__section-title"],"layout_main_navbar_nav_menu":["4"],"_layout_main_navbar_nav_menu":["field_layout_main_navbar_nav_menu"],"layout_main_navbar_affix":["1"],"_layout_main_navbar_affix":["field_layout_main_navbar_affix"],"layout_main_navbar_affix_simulate":["1"],"_layout_main_navbar_affix_simulate":["field_layout_main_navbar_affix_simulate"],"layout_header_template_class":[""],"_layout_header_template_class":["field_layout_header_template_class"],"layout_header_template_page_title_custom":["0"],"_layout_header_template_page_title_custom":["field_layout_header_template_page_title_custom"],"layout_header_template_page_title_type":["0"],"_layout_header_template_page_title_type":["field_layout_header_template_page_title_type"],"layout_header_template_style":["jumbotron"],"_layout_header_template_style":["field_layout_header_template_style"],"layout_header_template_container":["inside"],"_layout_header_template_container":["field_layout_header_template_container"]}}';

$make_post = json_decode($json_post);  
$temp_post = array();
$temp_meta = array();
foreach ($make_post as $key => $value) {
	if($key!='meta_input'){
		$temp_post[$key] = $value;
	}else{
		foreach ($value as $k => $v) {
			$temp_meta[] = (object) ['meta_key' => $k, 'meta_value' => $v[0]]; 
		}
		
	}
} 


$current_user = wp_get_current_user();
$new_post_author = $current_user->ID; 
$temp_post['post_author'] = $new_post_author;

// insert post
$new_post_id = wp_insert_post( $temp_post );

// set terms
$post_terms = array(
	'default',
);
if( $temp_post['post_type'] == 'wpbc_template' ){
	wp_set_object_terms($new_post_id, $post_terms, 'wpbc_template_type', false); 
}

// all the meta
if (count($temp_meta)!=0) {

	global $wpdb; 

	$sql_query = "INSERT INTO $wpdb->postmeta (post_id, meta_key, meta_value) ";
	foreach ($temp_meta as $meta_info) {
		$meta_key = $meta_info->meta_key;
		$meta_value = addslashes($meta_info->meta_value);
		$sql_query_sel[]= "SELECT $new_post_id, '$meta_key', '$meta_value'";
	}
	$sql_query.= implode(" UNION ALL ", $sql_query_sel);
	$wpdb->query($sql_query);
}

if( !is_wp_error($new_post_id) ) {

	echo "Post created: ".$new_post_id;

	_print_code($temp_post); 

}



?>